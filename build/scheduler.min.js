/*! scheduler 2013-10-24 */
function noop(){}function getWidth(a){var b=parseFloat(a);return b||(b=.5),Math.floor(160*b)}function getSlotPosition(a){return Math.floor((a-168)/80)}function getSlots(a){var b=Math.ceil(a/.5);return isNaN(b)||0===b?1:b}function blankLabel(){return $("<span>").addClass("time-label").html("&nbsp")}function ampm(a){return 0==(Math.floor(a/12)+1)%2?"am":"pm"}function timeLabel(){for(var a=$("#time-label").append(blankLabel()).append(blankLabel()),b=0;61>b;b++){var c=b%12;c=c||12,a.append($("<span>").addClass("time-label").html(c+ampm(b))).append(blankLabel())}}function dayLabel(){for(var a=$("#day-label").append(blankLabel()).append(blankLabel()),b=["Friday","Friday","Saturday","Saturday","Saturday","Saturday","Sunday","Sunday","Sunday","Sunday","Monday"],c=0;121>c;c++)0==c%12?a.append($("<span>").addClass("time-label").html(b.shift())):a.append(blankLabel())}function send(a){CMD[a[0]].apply(null,a[1])}function getDialogFields(){var a={};return $("#dialog fieldset label").each(function(){var b=$(this).attr("for");a[b]=wrapDialogField($(this).parent().find('[name="'+b+'"]'))}),a}function wrapDialogField(a){var b=function(b){return b?a.val(b):a.val()},c=function(){a.val("").removeClass("ui-state-error")},d=a.prop("tagName"),e=a.attr("type");return"SELECT"==d||"INPUT"==d&&"button"==e&&(c=noop),{val:b,reset:c}}function populateFields(a){var b=POSITIONS[a];DIALOG_FIELDS.event_name.val(b.name),DIALOG_FIELDS.host.val(b.host),DIALOG_FIELDS.duration.val(b.time)}function addEventDialog(){$("#dialog").dialog({modal:!0,buttons:{Create:function(){editEvent(-1,DIALOG_FIELDS),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){$.each(DIALOG_FIELDS,function(){this.reset()})}})}function editEventDialog(){var a=$(this);populateFields(a.attr("id")),$("#dialog").dialog({modal:!0,buttons:{Save:function(){editEvent(a.attr("id"),DIALOG_FIELDS),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){$.each(DIALOG_FIELDS,function(){this.reset()})}})}function addHostDialog(){var a=$("#addhostdialog input");$('#dialog select[name="host"]'),$("#addhostdialog").dialog({modal:!0,buttons:{Add:function(){var b=a.val(),c=b.toLowerCase();HOSTS[c]?a.addClass("ui-state-error"):send(["add_host",[b,c]])},Cancel:function(){$(this).dialog("close")}},close:function(){$(this).find("input").val("").removeClass("ui-state-error")}})}function store(a){var b={top:parseInt(a.css("top").slice(0,-2)),left:parseInt(a.css("left").slice(0,-2)),name:a.data("name"),time:a.data("time"),host:a.data("host")};return POSITIONS[a.attr("id")]=b,a}function editEvent(a,b){var c=b.event_name.val(),d=parseFloat(b.duration.val()),e=b.host.val();d=isNaN(d)?.5:d,send(["edit",[a,c,d,e]])}function addEvent(){var a={hasmoved:!1,id:"eventid"+getId()},b={width:getWidth(.5)},c=$("<div>",{id:a.id}).addClass("border-label").html(a.name).data(a).css(b);return $(this).after(c),c.dblclick(editEventDialog),c}function overlapRemove(a,b,c,d,e){var f=c.host;b.removeClass("conflict");for(var g=d;d+e>g;g++)OVERLAP[g][f]=OVERLAP[g][f].filter(function(b){return b!==a}),1===OVERLAP[g][f].length&&$("#"+OVERLAP[g][f][0]).removeClass("conflict")}function overlapAdd(a,b,c,d){for(var e=c;c+d>e;e++)OVERLAP[e][b]?(OVERLAP[e][b].push(a),Object.keys(OVERLAP[e][b]).length>=2&&$.each(OVERLAP[e][b],function(a,b){$("#"+b).addClass("conflict")})):OVERLAP[e][b]=[a]}for(var DIALOG_FIELDS,POSITIONS={},HOSTS={},CMD={},OVERLAP=new Array(122),i=0;i<OVERLAP.length;i++)OVERLAP[i]={};var getId=function(){var a=0;return function(){return a++}}();CMD.add_host=function(a,b){var c=$("#addhostdialog input"),d=$('#dialog select[name="host"]');HOSTS[b]?c.addClass("ui-state-error"):(HOSTS[b]=a,d.append($("<option>",{value:a}).html(a)),$("#addhostdialog").dialog("close"))},CMD.edit=function(a,b,c,d){var e,f={name:b,time:c,host:d},g={width:getWidth(c)};if(-1===a)e=addEvent.call($("#add"));else{e=$("#"+a);var h=POSITIONS[a];if(h.host!==d||h.time!==c){var i=getSlotPosition(h.left),j=getSlots(h.time);overlapRemove(a,e,h,i,j),j=getSlots(c),overlapAdd(a,d,i,j)}}return e.html(f.name).data(f).css(g),e.draggable({grid:[80,20],appendTo:"body",helper:function(){return $("<div>").addClass("border-label").html(f.name).css(g).css({background:"gray"})},stop:function(a,b){send(["move",[$(a.target).attr("id"),b.position.top,b.position.left]])}}),store(e),e},CMD.move=function(a,b,c){var d=POSITIONS[a],e=$("#"+a),f=getSlotPosition(d.left),g=d?getSlots(d.time):getSlots(e.data("time")),h=d.host;d&&f>=0&&overlapRemove(a,e,d,f,g),store($("#"+a).css({position:"absolute",top:b,left:c})),f=getSlotPosition(c),overlapAdd(a,h,f,g)},$(function(){timeLabel(),dayLabel();var a=["Bee Hall","Conference","Gluttony","Hell","My Butt","Your butt"];for(var b in a)$("#time-label").after($("<div>").addClass("room-highlight")),$("#rooms").append($("<div>").addClass("room-label").html(a[b]));$("#add").click(addEventDialog),$('#dialog input[name="add_host"]').click(addHostDialog),DIALOG_FIELDS=getDialogFields()});